{"version":3,"file":"commonHelpers.js","sources":["../src/js/get-refs.js","../src/index.js"],"sourcesContent":["export default function getRefs() {\n  return {\n    searchForm: document.querySelector('#search-form'),\n    gallery: document.querySelector('.gallery'),\n  };\n}\n","import axios from 'axios';\nimport getRefs from './js/get-refs';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport AOS from 'aos';\nimport 'aos/dist/aos.css';\nAOS.init();\n\nconst refs = getRefs();\n\nlet page = '1';\nlet query = '';\nlet per_page = 40;\nlet isFirstSearch = false;\nlet stopFetching = false;\nlet isScroll = false;\n\nconst BASE_URL = 'https://pixabay.com/api';\nconst API_KEY = '32083326-5131f12fe438843c4a27c5327';\n\nlet lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nasync function fetchPictures(query, page) {\n  if (stopFetching) return;\n  const params = new URLSearchParams({\n    key: API_KEY,\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: 'true',\n    page: page,\n    per_page: per_page,\n  });\n  const response = await axios.get(`${BASE_URL}/?${params}`);\n  if (response.status !== 200) {\n    throw new Error(response.status);\n  }\n  return response.data;\n}\n\nasync function getPictures(query, page) {\n  try {\n    const res = await fetchPictures(query, page);\n    const arrayLength = res.hits.length;\n    if (arrayLength === 0 || res.total === 0) {\n      throw new Error(response.status);\n    }\n\n    if (isFirstSearch) {\n      iziToast.success({\n        title: 'OK',\n        message: `Hooray! We found ${res.totalHits} images.`,\n        position: 'topRight',\n      });\n      isFirstSearch = false;\n    }\n\n    renderPictures(res.hits);\n\n    const allPictures = (page - 1) * per_page + res.hits.length;\n    const totalHits = res.totalHits;\n\n    if (allPictures >= totalHits) {\n      iziToast.error({\n        title: 'Error',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n\n      stopFetching = true;\n      return;\n    }\n    lightbox.refresh();\n  } catch (error) {\n    if (!stopFetching) {\n      iziToast.error({\n        title: 'Error',\n        message:\n          'Sorry, there are no images matching your search query. Please try again.',\n        position: 'topRight',\n      });\n    }\n    stopFetching = true;\n  }\n}\n\nfunction renderPictures(pictures) {\n  const pictureElem = pictures\n    .map(\n      ({\n        largeImageURL,\n        previewURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `<div class=\"photo-card\">\n      <a class=\"gallery__item\" href=\"${largeImageURL}\">\n       <img class=\"gallery__image\" src=\"${previewURL}\" alt=\"${tags}\" loading=\"lazy\" />\n      </a>\n      <div class=\"info\">\n        <p class=\"info-item\">\n          <b>Likes</b>\n          ${likes}\n        </p>\n        <p class=\"info-item\">\n          <b>Views</b>\n          ${views}\n        </p>\n        <p class=\"info-item\">\n          <b>Comments</b>\n          ${comments}\n        </p>\n        <p class=\"info-item\">\n          <b>Downloads</b>\n          ${downloads}\n        </p>\n      </div>\n    </div>\n`;\n      }\n    )\n    .join('');\n\n  refs.gallery.insertAdjacentHTML('beforeend', pictureElem);\n}\n\nrefs.searchForm.addEventListener('submit', onSubmit);\n\nfunction onSubmit(event) {\n  stopFetching = false;\n  isScroll = false;\n  event.preventDefault();\n  page = 1;\n  isFirstSearch = true;\n  refs.gallery.innerHTML = '';\n\n  query = event.target.elements.searchQuery.value.trim();\n  if (query === '') {\n    iziToast.warning({\n      title: 'Caution',\n      message: 'Please enter your query.',\n      position: 'topRight',\n    });\n    return;\n  }\n\n  try {\n    refs.searchForm.reset();\n    getPictures(query, page);\n  } catch (error) {\n    console.error(error);\n  }\n}\n\nwindow.addEventListener('scroll', async () => {\n  const documentRect = document.documentElement.getBoundingClientRect();\n  if (!isScroll) {\n    isScroll = true;\n    return;\n  }\n  if (documentRect.bottom < document.documentElement.clientHeight + 150) {\n    page += 1;\n    getPictures(query, page);\n  }\n});\n"],"names":["getRefs","AOS","refs","page","query","per_page","isFirstSearch","stopFetching","isScroll","BASE_URL","API_KEY","lightbox","SimpleLightbox","fetchPictures","params","response","axios","getPictures","res","iziToast","renderPictures","allPictures","totalHits","pictures","pictureElem","largeImageURL","previewURL","tags","likes","views","comments","downloads","onSubmit","event","error","documentRect"],"mappings":"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"}